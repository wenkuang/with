define("app/src/app/main",["lib/jquery-lib","lib/artDialog/jquery-artDialog","../../common/core","../../tpl/search","../../tpl/upload","./page"],function(e){e("lib/jquery-lib"),e("lib/artDialog/jquery-artDialog"),core=e("../../common/core"),App=e("./page"),App.init()}),define("app/common/core",["../tpl/search","../tpl/upload"],function(require,exports){return{filetype:{music:["mp3","wma","wav","mid","aac","ogg","oga","midi","ram","ac3","aif","aiff","m3a","m4a","m4b","mka","mp1","mx3","mp2"],movie:["avi","flv","f4v","wmv","3gp","rmvb","mp4","rm","rmvb","flv","mkv","wmv","asf","avi","aiff","mp4","divx","dv","m4v","mov","mpeg","vob","mpg","mpv","ogm","ogv","qt"],image:["jpg","jpeg","png","bmp","gif","ico","tif","tiff","dib","rle"],code:["html","htm","js","css","less","scss","sass","py","php","rb","erl","lua","pl","c","cpp","m","h","java","jsp","cs","asp","sql","as","go","lsp","yml","json","tpl","xml","cmd","reg","bat","vbs","sh"],doc:["doc","docx","docm","xls","xlsx","xlsb","xlsm","ppt","pptx","pptm"],text:["txt","ini","inc","inf","conf","oexe","md","htaccess","csv","log","asc","tsv"],bindary:["pdf","zip","swf","gzip","rar","arj","tar","gz","cab","tbz","tbz2","lzh","uue","bz2","ace","exe","so","dll","chm","rtf","odp","odt","pages","class","psd","ttf"]},contextmenu:function(){rightMenu.hidden();var e=event||window.event;return $.nodeName(e.target,"TEXTAREA")||$.nodeName(e.target,"INPUT")?!0:!1},pathThis:function(e){e=e.replace(/\\/g,"/");var t=e.split("/"),a=t[t.length-1];return""==a&&(a=t[t.length-2]),a},pathFather:function(e){e=e.replace(/\\/g,"/");var t=e.lastIndexOf("/");return e.substr(0,t+1)},pathExt:function(e){e=e.replace(/\\/g,"/"),e=e.replace(/\/+/g,"/");var t=e.lastIndexOf(".");return e.substr(t+1)},path2url:function(e){if(e=e.replace(/\\/g,"/"),e=e.replace(/\/+/g,"/"),e=e.replace(/\/\.*\//g,"/"),G.is_root){if(e.substring(0,G.web_root.length)==G.web_root)return G.web_host+e.replace(G.web_root,"");var t=G.basic_path.replace(G.web_root,"")+"/";return t=G.web_host+t,t+"index.php?explorer/fileProxy&path="+urlEncode(e)}return G.web_host+G.web_root+e},setting:function(e){void 0==e&&(e=""),void 0==window.top.frames.Opensetting_mode?$.dialog.open("?setting#"+e,{id:"setting_mode",fixed:!0,resize:!0,title:LNG.setting,width:960,height:580}):($.dialog.list.setting_mode.display(!0),FrameCall.top("Opensetting_mode","Setting.setGoto",'"'+e+'"'))},appStore:function(){$.dialog.open("./index.php?app",{id:"app_store",fixed:!0,resize:!0,title:"应用商店",width:800,height:500})},openApp:function(app){if("url"==app.type)"number"!=typeof app.width&&-1==app.width.search("%")&&(app.width=parseInt(app.width)),"number"!=typeof app.height&&-1==app.height.search("%")&&(app.height=parseInt(app.height)),$.dialog.open(app.content,{title:app.name,fixed:!0,resize:app.resize,simple:app.simple,title:app.name.replace(".oexe",""),width:app.width,height:app.height});else{var exec=app.content;eval("{"+exec+"}")}},update:function(e){var t=base64_decode("aHR0cDovL3N0YXRpYy5rYWxjYWRkbGUuY29tL3VwZGF0ZS9tYWluLmpz");require.async(t,function(t){try{t.todo(e)}catch(a){}})},explorer:function(e){void 0==e&&(e=""),$.dialog.open("?/explorer&type=iframe&path="+e,{resize:!0,fixed:!0,title:LNG.ui_filemanage,width:880,height:550})},setSkin:function(e,t){var a="./../../../style/skin/"+e+t,i=G.static_path+"style/skin/"+e+t;require.async(a,function(){$("#link_css_list").attr("href",i),$("link[rel=stylesheet]").each(function(){var e=$(this).attr("href");e.substring(e.length-t.length)==t&&"link_css_list"!=$(this).attr("id")&&$(this).remove()})})},editorFull:function(){var e=$("iframe[name=OpenopenEditor]");e.toggleClass("frame_fullscreen")},bindTopEvent:function(){$(".top_right").click(function(e){var t=$(this);t.hasClass("this")?t.removeClass("this").find(".dropmenu").hide():t.addClass("this").find(".dropmenu").show(),e.stopPropagation()}),$(document).click(function(){var e=$(".top_right");e.hasClass("this")&&e.removeClass("this").find(".dropmenu").hide()})},tips:{loading:function(e){Tips.loading(e,"info",Global.topbar_height)},close:function(e,t){"object"==typeof e?Tips.close(e.data,e.code,Global.topbar_height):Tips.close(e,t,Global.topbar_height)},tips:function(e,t){"object"==typeof e?Tips.tips(e.data,e.code,Global.topbar_height):Tips.tips(e,t,Global.topbar_height)}},search:function(e,t){var a,i,s=require("../tpl/search"),o=function(){var o=template.compile(s.html);0==$(".dialog_do_search").length?(c(),i={search:e,path:t,is_content:void 0,is_case:void 0,ext:"",LNG:LNG},a=$.dialog({id:"dialog_do_search",padding:0,fixed:!0,resize:!0,title:LNG.search,width:450,content:o(i)}),r(i),$("#search_ext").tooltip({placement:"bottom",html:!0}),$("#search_path").tooltip({placement:"bottom",html:!0,title:function(){return $("#search_path").val()}})):($("#search_value").val(e),$("#search_path").val(t),n(),$.dialog.list.dialog_do_search.display(!0))},n=function(){i={search:$("#search_value").val(),path:$("#search_path").val(),is_content:$("#search_is_content").attr("checked"),is_case:$("#search_is_case").attr("checked"),ext:$("#search_ext").val()},r(i)},c=function(){$("#search_value,#search_ext,#search_path").keyEnter(n),$(".search_header a.button").die("click").live("click",n),$(".search_result .list .name").die("click").live("click",function(){var e=$(this).find("a").html(),t=$(this).parent().find(".path a").html()+e;$(this).parent().hasClass("file")?ui.pathOpen.open(t):"explorer"==Config.pageApp?ui.path.list(t+"/","tips"):core.explorer(t+"/")}),$(".search_result .list .path a").die("click").live("click",function(){var e=$(this).html();"explorer"==Config.pageApp?ui.path.list(e,"tips"):core.explorer(e)})},r=function(e){var t=150;$("#search_value").focus(),$(".search_result .list").remove();var a=$(".search_result .message td");return e.search&&e.path?($.ajax({url:"index.php?explorer/search",dataType:"json",type:"POST",data:e,beforeSend:function(){a.hide().html(LNG.searching+'<img src="'+G.static_path+'images/loading.gif">').fadeIn(t)},success:function(e){if(!e.code)return a.hide().html(e.data).fadeIn(t),void 0;if(0==e.data.filelist.length&&0==e.data.folderlist.length)return a.hide().html(LNG.search_null).fadeIn(t),void 0;a.hide();var i=template.compile(s.list);e.data.LNG=LNG,$(i(e.data)).insertAfter(".search_result .message").fadeIn(t)},error:function(){a.hide().html(LNG.system_error).fadeIn(t)}}),void 0):(a.hide().html(LNG.search_info).fadeIn(t),void 0)};o()},upload:function(){G.upload_path=G.this_path;var e=urlDecode(G.upload_path);uploader.option("server","index.php?explorer/fileUpload&path="+G.upload_path);var t=30>=e.length?e:"..."+e.substr(e.length-30);if(0!=$(".dialog_file_upload").length)return $(".file_upload .upload_path b").html(t),$.dialog.list.dialog_file_upload.display(!0),void 0;var a=require("../tpl/upload"),i=template.compile(a.html),s=WebUploader.Base.formatSize(G.upload_max);$.dialog({padding:5,height:430,resize:!0,id:"dialog_file_upload",fixed:!0,title:LNG.upload_muti,content:i({LNG:LNG,maxsize:s}),close:function(){$.each(uploader.getFiles(),function(e,t){uploader.skipFile(t),uploader.removeFile(t)})}}),$(".file_upload .tips").tooltip({placement:"bottom"}),$(".file_upload .upload_path").tooltip({placement:"bottom",title:function(){return G.upload_path}}),$(".file_upload .upload_path b").html(t),$(".file_upload .top_nav a.menu").unbind("click").bind("click",function(){$(this).hasClass("tab_upload")?($(".file_upload .tab_upload").addClass("this"),$(".file_upload .tab_download").removeClass("this"),$(".file_upload .upload_box").removeClass("hidden"),$(".file_upload .download_box").addClass("hidden")):($(".file_upload .tab_upload").removeClass("this"),$(".file_upload .tab_download").addClass("this"),$(".file_upload .upload_box").addClass("hidden"),$(".file_upload .download_box").removeClass("hidden"))}),$(".file_upload .download_box .submit input").unbind("click").bind("click",function(){core.server_dwonload(G.upload_path)}),uploader.addButton({id:"#picker"})},server_dwonload:function(e){var t=[];$(".list input").each(function(){""!=$(this).val()&&t.push($(this).val())}),core.tips.tips(t.length+LNG.server_dwonload_desc);for(var a=0;t.length>a;a++)$.ajax({url:"?explorer/serverDownload&save_path="+e+"&url="+urlEncode2(t[a]),dataType:"json",success:function(e){e.code&&FrameCall.father("ui.f5",""),core.tips.tips(e)},error:function(){core.tips.tips(LNG.system_error,!1)}})},upload_init:function(){var e="#thelist",t="span.state";uploader=WebUploader.create({swf:G.static_path+"js/lib/webuploader/Uploader.swf",dnd:"body",threads:3,fileSizeLimit:G.upload_max,resize:!1});var a=[];uploader.on("fileQueued",function(t){var i=$(e);$(e).find(".item").length>0&&(i=$(e).find(".item:eq(0)"));var s='<div id="'+t.id+'" class="item">'+'<div class="info"><span class="title">'+t.name+'</span><span class="state">'+LNG.upload_ready+'</span><div style="clear:both"></div></div></div>';$(e).find(".item").length>0?$(s).insertBefore($(e).find(".item:eq(0)")):$(e).append(s),a.push(t.name),uploader.upload()}).on("uploadProgress",function(e,a){var i=$("#"+e.id),s=i.find(".progress .progress-bar");s.length||(s=$('<div class="progress progress-striped active"><div class="progress-bar" role="progressbar" style="width: 0%"></div></div>').appendTo(i).find(".progress-bar")),i.find(t).text((100*a).toFixed(2)+"%"),s.css("width",100*a+"%")}).on("uploadAccept",function(e,t){e.file.serverData=t}).on("uploadSuccess",function(e){var i=e.serverData;i.code?$("#"+e.id).find(t).text(i.data):$("#"+e.id).find(t).addClass("error").text(i.data),uploader.removeFile(e),$("#"+e.id).find(".progress").fadeOut();var s=a;ui.f5_callback(function(){ui.path.setSelectByFilename(s)})}).on("uploadError",function(e){$("#"+e.id).find(t).addClass("error").text(LNG.upload_error)}).on("uploadFinished",function(){$(e).find(".item").delay(2e3).each(function(e){$(this).delay(300*e).slideUp(600)}),a=[]}).on("error",function(){});var i;inState=!1,dragOver=function(e){stopPP(e),0==inState&&(inState=!0,MaskView.tips(LNG.upload_drag_tips)),i&&window.clearTimeout(i)},dragLeave=function(e){stopPP(e),i&&window.clearTimeout(i),i=window.setTimeout(function(){inState=!1,MaskView.close()},100)},dragDrop=function(e){stopPP(e),inState&&(inState=!1,MaskView.close()),core.upload()}}}}),define("app/tpl/search",[],function(){var e="<div class='do_search'>        <div class='search_header'>           <div class='s_br'>                <input type='text' id='search_value' value='{{search}}'/><a class='right button icon-search'></a>                <div style='float:right'>{{LNG.path}}:<input type='text' id='search_path' value='{{path}}'/></div>            </div>           <div class='s_br'>                <input type='checkbox' id='search_is_case' {{if is_case}}checked='true'{{/if}}/>                <label for='search_is_case'>{{LNG.search_uplow}}</label>                <input type='checkbox' id='search_is_content' {{if is_content}}checked='true'{{/if}}/>                <label for='search_is_content'>{{LNG.search_content}}</label>                <div style='float:right'>{{LNG.file_type}}:<input type='text' id='search_ext' value='{{ext}}' title='{{LNG.search_ext_tips}}'/></div>            </div>        </div>        <div class='search_result'>            <table border='0' cellspacing='0' cellpadding='0'>                <tr class='search_title'>                   <td class='name'>{{LNG.name}}</td>                   <td class='type'>{{LNG.type}}</td>                   <td class='size'>{{LNG.size}}</td>                   <td class='path'>{{LNG.path}}</td>                </tr>                <tr class='message'><td colspan='4'></td></tr>            </table>        </div>    </div>",t="{{each folderlist as v i}}        <tr class='list folder' data-path='{{v.path}}{{v.name}}' data-type='folder' data-size='0'>            <td class='name'><a href='javascript:void(0);' title='{{LNG.open}}{{v.name}}'>{{v.name}}</a></td>            <td class='type'>{{LNG.folder}}</td>            <td class='size'>0</td>            <td class='path'><a href='javascript:void(0);' title='{{LNG.goto}}{{v.path}}'>{{v.path}}</a></td>        </tr>    {{/each}}    {{each filelist as v i}}        <tr class='list file'            data-path='{{v.path}}{{v.name}}'             data-type='{{v.ext}}'             data-size='{{v.size}}'>            <td class='name'><a href='javascript:void(0);' title='{{LNG.open}}{{v.name}}'>{{v.name}}</a></td>            <td class='type'>{{v.ext}}</td>            <td class='size'>{{v.size_friendly}}</td>            <td class='path'><a href='javascript:void(0);' title='{{LNG.goto}}{{v.path}}'>{{v.path}}</a></td>        </tr>    {{/each}}";return{html:e,list:t}}),define("app/tpl/upload",[],function(){return{html:"<div class='file_upload'>            <div class='top_nav'>               <a href='javascript:void(0);' class='menu this tab_upload'>{{LNG.upload_local}}</a>               <a href='javascript:void(0);' class='menu tab_download''>{{LNG.download_from_server}}</a>               <a class='button' style='margin:-1px 0 0 10px;cursor: pointer;' href='javascript:core.upload()'>{{LNG.upload_path_current}}</a>               <div style='clear:both'></div>            </div>            <div class='upload_path'>{{LNG.save_path}}:<b></b></div>            <div class='upload_box'>                <div class='btns'><div id='picker'>{{LNG.upload_select}}</div>                <div tips class='tips' title='{{LNG.upload_size_info}}'>{{LNG.upload_max_size}}:{{maxsize}}</div>                <div style='clear:both'></div></div>                <div id='uploader' class='wu-example'>                    <div id='thelist' class='uploader-list'></div>                </div>            </div>            <div class='download_box hidden'>                <form id='form' method='post'>                    <div class='list'>{{LNG.download_address}}1: <input type='text' name='url1'/></div>                    <div class='list'>{{LNG.download_address}}2: <input type='text' name='url2'/></div>                    <div class='list'>{{LNG.download_address}}3: <input type='text' name='url3'/></div>                    <div class='list'>{{LNG.download_address}}4: <input type='text' name='url4'/></div>                    <div class='list'>{{LNG.download_address}}5: <input type='text' name='url5'/></div>                    <div class='submit'><input type='button' name='' value='{{LNG.button_submit}}' class=''/></div>                </form>            </div>        </div>"}}),define("app/src/app/page",[],function(){var e,t=function(){e=location.hash.split("#",2)[1],e||(e="all"),i(e),$("ul.setting li").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")}).click(function(){e=$(this).attr("id"),i(e)}),$(".box .list").live("hover",function(){$(this).addClass("listhover")},function(){$(this).toggleClass("listhover")}).live("click",function(){var e="index.php?setting/set&k="+type+"&v="+value;$.ajax({url:e,type:"json",success:function(e){tips(e)}})}),$("a.create_app").bind("click",function(){FrameCall.father("ui.path.pathOperate.appEdit",'"","","root_add"')}),$(".app-list li .right a.button").live("click",function(){var e=json_decode($(this).parent().parent().attr("data")),t=$(this).attr("action");switch(t){case"preview":core.openApp(e);break;case"add":FrameCall.father("get","G.this_path");var a=share.data("create_app_path"),s=urlEncode(a+e.name),o="./index.php?app/user_app&action=add&path="+s;$.ajax({url:o,dataType:"json",type:"POST",data:"data="+urlEncode(json_encode(e)),success:function(e){tips(e),e.code&&FrameCall.father("ui.f5","")}});break;case"edit":FrameCall.father("ui.path.pathOperate.appEdit","'"+json_encode(e)+"','','root_edit'");break;case"del":$.ajax({url:"?app/del&name="+urlEncode(e.name),dataType:"json",beforeSend:function(){},success:function(e){tips(e),e.code&&i()}});break;default:}})},a=function(e){var t="",a="<a class='button' action='edit' href='javascript:;'>编辑</a>						 <a class='button' action='del' href='javascript:;'>删除</a>";G.is_root||(a="");for(var i in e){var s=e[i].icon;-1==s.search(G.static_path)&&"http"!=s.substring(0,4)&&(s=G.static_path+"images/app/"+s),t+="<li data='"+json_encode(e[i])+"'>				<a href='javascript:;' class='icon'><img src='"+s+"'></a>				<p><span class='title'>"+e[i].name+"</span>				<span class='info'>"+e[i].desc+"</span></p>				<div class='right'>					<a class='button' action='preview' 'href=javascript:;'>预览</a>					<a class='button' action='add' href='javascript:;'>添加</a>				"+a+"</div>				<div style='clear:both;'></div>			</li>"}return t},i=function(t){(void 0==t||""==t)&&(t=e),window.location.href="#"+t,$(".selected").removeClass("selected"),$("ul.setting li#"+t).addClass("selected"),$(".main").find(".h1").html($(".selected").html());var i=$(".main .app-list");$.ajax({url:"?app/get&group="+t,dataType:"json",beforeSend:function(){},success:function(e){i.css("display","none").html(a(e.data)).fadeIn("fast")}})};return{reload:i,init:t}});