var dragEnter=dragOver=dragLeave=dragDrop=function(){};(function(C,E){var A=(function(F,K){var L={},G=function(P,Q){var N,M,O;if(typeof P==="string"){return J(P)}else{N=[];for(M=P.length,O=0;O<M;O++){N.push(J(P[O]))}return Q.apply(null,N)}},I=function(O,M,N){if(arguments.length===2){N=M;M=null}if(typeof O!=="string"||!N){throw new Error("Define Error")}G(M||[],function(){H(O,N,arguments)})},H=function(P,O,N){var M={exports:O},Q;if(typeof O==="function"){N.length||(N=[G,M.exports,M]);Q=O.apply(null,N);Q!==K&&(M.exports=Q)}L[P]=M.exports},J=function(N){var M=L[N]||F[N];if(!M){throw new Error("`"+N+"` is undefined")}return M};return{define:I,require:G,modules:L}})(C),B=A.require,D=A.define;D("base",["jQuery"],function(H){var J=function(){},I=Function.call;function F(L){return function(){return I.apply(L,arguments)}}function K(L,M){return function(){return L.apply(M,arguments)}}function G(L){var M;if(Object.create){return Object.create(L)}else{M=function(){};M.prototype=L;return new M()}}return{version:"0.1.0",$:H,Deferred:H.Deferred,isPromise:function(L){return L&&typeof L.then==="function"},when:H.when,browser:(function(Q){var M={},N=Q.match(/WebKit\/([\d.]+)/),P=Q.match(/Chrome\/([\d.]+)/)||Q.match(/CriOS\/([\d.]+)/),O=Q.match(/MSIE\s([\d.]+)/),L=Q.match(/Firefox\/([\d.]+)/),R=Q.match(/Safari\/([\d.]+)/),S=Q.match(/OPR\/([\d.]+)/);N&&(M.webkit=parseFloat(N[1]));P&&(M.chrome=parseFloat(P[1]));O&&(M.ie=parseFloat(O[1]));L&&(M.firefox=parseFloat(L[1]));R&&(M.safari=parseFloat(R[1]));S&&(M.opera=parseFloat(S[1]));return M})(navigator.userAgent),inherits:function(N,L,O){var M;if(typeof L==="function"){M=L;L=null}else{if(L&&L.hasOwnProperty("constructor")){M=L.constructor}else{M=function(){return N.apply(this,arguments)}}}H.extend(true,M,N,O||{});M.__super__=N.prototype;M.prototype=G(N.prototype);L&&H.extend(true,M.prototype,L);return M},noop:J,bindFn:K,log:(function(){if(C.console){return K(console.log,console)}return J})(),nextTick:(function(){return function(L){setTimeout(L,1)}})(),slice:F([].slice),guid:(function(){var L=0;return function(M){var N=(+new Date()).toString(32),O=0;for(;O<5;O++){N+=Math.floor(Math.random()*65535).toString(32)}return(M||"wu_")+N+(L++).toString(32)}})(),formatSize:function(L,O,M){var N;M=M||["B","K","M","G","TB"];while((N=M.shift())&&L>1024){L=L/1024}return(N==="B"?L:L.toFixed(O||2))+N}}});D("mediator",["base"],function(L){var H=L.$,G=[].slice,J=/\s+/,F;function M(O,N,Q,P){return H.grep(O,function(R){return R&&(!N||R.e===N)&&(!Q||R.cb===Q||R.cb._cb===Q)&&(!P||R.ctx===P)})}function K(O,P,N){H.each((O||"").split(J),function(R,Q){N(Q,P)})}function I(Q,O){var S=false,R=-1,N=Q.length,P;while(++R<N){P=Q[R];if(P.cb.apply(P.ctx2,O)===false){S=true;break}}return !S}F={on:function(O,R,P){var N=this,Q;if(!R){return this}Q=this._events||(this._events=[]);K(O,R,function(S,U){var T={e:S};T.cb=U;T.ctx=P;T.ctx2=P||N;T.id=Q.length;Q.push(T)});return this},once:function(O,Q,P){var N=this;if(!Q){return N}K(O,Q,function(S,T){var R=function(){N.off(S,R);return T.apply(P||N,arguments)};R._cb=T;N.on(S,R,P)});return N},off:function(O,N,Q){var P=this._events;if(!P){return this}if(!O&&!N&&!Q){this._events=[];return this}K(O,N,function(S,R){H.each(M(P,S,R,Q),function(){delete P[this.id]})});return this},trigger:function(P){var N,O,Q;if(!this._events||!P){return this}N=G.call(arguments,1);O=M(this._events,P);Q=M(this._events,"all");return I(O,N)&&I(Q,arguments)}};return H.extend({installTo:function(N){return H.extend(N,F)}},F)});D("uploader",["base","mediator"],function(G,I){var H=G.$;function F(J){this.options=H.extend(true,{},F.options,J);this._init(this.options)}F.options={};I.installTo(F.prototype);H.each({upload:"start-upload",stop:"stop-upload",getFile:"get-file",getFiles:"get-files",removeFile:"remove-file",skipFile:"skip-file",retry:"retry",isInProgress:"is-in-progress",makeThumb:"make-thumb",getDimension:"get-dimension",addButton:"add-btn",getRuntimeType:"get-runtime-type",refresh:"refresh",disable:"disable",enable:"enable"},function(J,K){F.prototype[J]=function(){return this.request(K,arguments)}});H.extend(F.prototype,{state:"pending",_init:function(J){var K=this;K.request("init",J,function(){K.state="ready";K.trigger("ready")})},option:function(K,L){var J=this.options;if(arguments.length>1){if(H.isPlainObject(L)&&H.isPlainObject(J[K])){H.extend(J[K],L)}else{J[K]=L}}else{return K?J[K]:J}},getStats:function(){var J=this.request("get-stats");return{successNum:J.numOfSuccess,cancelNum:J.numOfCancel,invalidNum:J.numOfInvalid,uploadFailNum:J.numOfUploadFailed,queueNum:J.numOfQueue}},trigger:function(M){var L=[].slice.call(arguments,1),J=this.options,K="on"+M.substring(0,1).toUpperCase()+M.substring(1);if(I.trigger.apply(this,arguments)===false){return false}if(H.isFunction(J[K])&&J[K].apply(this,L)===false){return false}if(H.isFunction(this[K])&&this[K].apply(this,L)===false){return false}return true},request:G.noop,reset:function(){}});G.create=function(J){return new F(J)};G.Uploader=F;return F});D("runtime/runtime",["base","mediator"],function(G,J){var I=G.$,K={},F=function(M){for(var L in M){if(M.hasOwnProperty(L)){return L}}return null};function H(L){this.options=I.extend({container:document.body},L);this.uid=G.guid("rt_")}I.extend(H.prototype,{getContainer:function(){var L=this.options,N,M;if(this._container){return this._container}N=L.container||I(document.body);M=I(document.createElement("div"));M.attr("id","rt_"+this.uid);M.css({position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"});N.append(M);N.addClass("webuploader-container");this._container=M;return M},init:G.noop,exec:G.noop,destroy:function(){if(this._container){this._container.parentNode.removeChild(this.__container)}this.off()}});H.orders="html5,flash";H.addRuntime=function(L,M){K[L]=M};H.hasRuntime=function(L){return !!(L?K[L]:F(K))};H.create=function(L,M){var N,O;M=M||H.orders;I.each(M.split(/\s*,\s*/g),function(){if(K[this]){N=this;return false}});N=N||F(K);if(!N){throw new Error("Runtime Error")}O=new K[N](L);return O};J.installTo(H.prototype);return H});D("runtime/client",["base","mediator","runtime/runtime"],function(G,I,H){var F=(function(){var K={};return{add:function(L){K[L.uid]=L},get:function(M){var L;if(M){return K[M]}for(L in K){return K[L]}return null},remove:function(L){delete K[L.uid]},has:function(){return !!this.get.apply(this,arguments)}}})();function J(K,M){var L=G.Deferred(),N;this.uid=G.guid("client_");this.runtimeReady=function(O){return L.done(O)};this.connectRuntime=function(O,P){if(N){return}L.done(P);if(typeof O==="string"&&F.get(O)){N=F.get(O)}else{if(!M&&F.has()){N=F.get()}}if(!N){N=H.create(O,O.runtimeOrder);F.add(N);N.promise=L.promise();N.once("ready",L.resolve);N.init();N.client=1;return N}N.promise.then(L.resolve);N.client++;return N};this.getRuntime=function(){return N};this.disconnectRuntime=function(){if(!N){return}N.client--;if(N.client<=0){F.remove(N);delete N.promise;N.destroy()}N=null};this.exec=function(){if(!N){return}var O=G.slice(arguments);K&&O.unshift(K);return N.exec.apply(this,O)};this.getRuid=function(){return N&&N.uid};this.destroy=(function(O){return function(){O&&O.apply(this,arguments);this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()}})(this.destroy)}I.installTo(J.prototype);return J});D("lib/blob",["base","runtime/client"],function(F,H){function G(I,J){var K=this;K.source=J;K.ruid=I;H.call(K,"Blob");this.uid=J.uid||this.uid;this.type=J.type||"";this.size=J.size||0;if(I){K.connectRuntime(I)}}F.inherits(H,{constructor:G,slice:function(I,J){return this.exec("slice",I,J)},getSource:function(){return this.source}});return G});D("lib/file",["base","lib/blob"],function(G,J){var F=0,H=/\.([^.]+)$/;function I(L,M){var K;J.apply(this,arguments);this.name=M.name||("untitled"+F++);K=H.exec(M.name)?RegExp.$1.toLowerCase():"";if(!this.type&&~"jpg,jpeg,png,gif,bmp".indexOf(K)){this.type="image/"+K}this.ext=K;this.lastModifiedDate=M.lastModifiedDate||(new Date()).toLocaleString()}return G.inherits(J,I)});D("lib/filepicker",["base","runtime/client","lib/file"],function(G,I,F){var H=G.$;function J(K){K=this.options=H.extend({},J.options,K);K.container=H(K.id);if(!K.container.length){throw new Error("按钮指定错误")}K.label=K.label||K.container.text()||"选择文件";K.button=H(K.button||document.createElement("div"));K.button.text(K.label);K.container.html(K.button);I.call(this,"FilePicker",true)}J.options={button:null,container:null,label:null,multiple:true,accept:null};G.inherits(I,{constructor:J,init:function(){var M=this,K=M.options,L=K.button;L.addClass("webuploader-pick");M.on("all",function(N){var O;switch(N){case"mouseenter":L.addClass("webuploader-pick-hover");break;case"mouseleave":L.removeClass("webuploader-pick-hover");break;case"change":O=M.exec("getFiles");M.trigger("select",H.map(O,function(P){return new F(M.getRuid(),P)}));break}});M.connectRuntime(K,function(){M.refresh();M.exec("init",K)});H(C).on("resize",function(){M.refresh()})},refresh:function(){var N=this.getRuntime().getContainer(),O=this.options.button,M=O.outerWidth(),L=O.outerHeight(),K=O.offset();M&&N.css({width:M+"px",height:L+"px"}).offset(K)},destroy:function(){if(this.runtime){this.exec("destroy");this.disconnectRuntime()}}});return J});D("widgets/widget",["base","uploader"],function(L,J){var H=L.$,K=J.prototype._init,M={},G=[];function F(P){if(!P){return false}var O=P.length,N=H.type(P);if(P.nodeType===1&&O){return true}return N==="array"||N!=="function"&&N!=="string"&&(O===0||typeof O==="number"&&O>0&&(O-1) in P)}function I(N){this.owner=N;this.options=N.options}H.extend(I.prototype,{init:L.noop,invoke:function(P,N){var O=this.responseMap;if(!O||!(P in O)||!(O[P] in this)||!H.isFunction(this[O[P]])){return M}return this[O[P]].apply(this,N)},request:function(){return this.owner.request.apply(this.owner,arguments)}});H.extend(J.prototype,{_init:function(){var O=this,N=O._widgets=[];H.each(G,function(Q,P){N.push(new P(O))});return K.apply(O,arguments)},request:function(T,S,W){var N=0,P=this._widgets,V=P.length,O=[],U=[],Q,R;S=F(S)?S:[S];for(;N<V;N++){Q=P[N];R=Q.invoke(T,S);if(R!==M){if(L.isPromise(R)){U.push(R)}else{O.push(R)}}}if(W||U.length){return L.when.apply(L,U).then(function(){var Y=L.Deferred(),X=arguments;setTimeout(function(){Y.resolve.apply(Y,X)},1);return Y.promise()}).then(W||L.noop)}else{return O[0]}}});J.register=I.register=function(P,O){var Q={init:"init"},N;if(arguments.length===1){O=P;O.responseMap=Q}else{O.responseMap=H.extend(Q,P)}N=L.inherits(I,O);G.push(N);return N};return I});D("widgets/filepicker",["base","uploader","lib/filepicker","widgets/widget"],function(F,G,H){F.$.extend(G.options,{pick:null,accept:null});return G.register({"add-btn":"addButton","refresh":"refresh"},{init:function(I){this.pickers=[];return I.pick&&this.addButton(I.pick)},refresh:function(){$.each(this.pickers,function(){this.refresh()})},addButton:function(K){var O=this,I=O.options,M=I.accept,L,N,J;if(!K){return}J=F.Deferred();if(typeof K==="string"){K={id:K}}L=$.extend({},K,{accept:$.isPlainObject(M)?[M]:M,swf:I.swf,runtimeOrder:I.runtimeOrder});N=new H(L);N.once("ready",J.resolve);N.on("select",function(P){O.owner.request("add-file",[P])});N.init();this.pickers.push(N);return J.promise()}})});D("file",["base","mediator"],function(H,I){var G=H.$,N="WU_FILE_",M=0,F=/\.([^.]+)$/,K={};function J(){return N+M++}function L(O){this.name=O.name||"Untitled";this.size=O.size||0;this.type=O.type||"image/png";this.lastModifiedDate=O.lastModifiedDate||(new Date()*1);this.id=J();this.ext=F.exec(this.name)?RegExp.$1:"";this.statusText="";K[this.id]=L.Status.INITED;this.source=O;this.loaded=0;this.on("error",function(P){this.setStatus(L.Status.ERROR,P)})}G.extend(L.prototype,{setStatus:function(O,Q){var P=K[this.id];typeof Q!=="undefined"&&(this.statusText=Q);if(O!==P){K[this.id]=O;this.trigger("statuschange",O,P)}},getStatus:function(){return K[this.id]},getSource:function(){return this.source},destory:function(){delete K[this.id]}});I.installTo(L.prototype);L.Status={INITED:"inited",QUEUED:"queued",PROGRESS:"progress",ERROR:"error",COMPLETE:"complete",CANCELLED:"cancelled",INTERRUPT:"interrupt",INVALID:"invalid"};return L});D("lib/dnd",["base","mediator","runtime/client"],function(F,J,H){var G=F.$;function I(K){K=this.options=G.extend({},I.options,K);K.container=G(K.container);if(!K.container.length){return}H.call(this,"DragAndDrop")}I.options={accept:null,disableGlobalDnd:true};F.inherits(H,{constructor:I,init:function(){var K=this;K.connectRuntime(K.options,function(){K.exec("init")})},destroy:function(){this.disconnectRuntime()}});J.installTo(I.prototype);return I});D("lib/filepaste",["base","mediator","runtime/client"],function(F,J,I){var H=F.$;function G(K){K=this.options=H.extend({},K);K.container=H(K.container||document.body);I.call(this,"FilePaste")}F.inherits(I,{constructor:G,init:function(){var K=this;K.connectRuntime(K.options,function(){K.exec("init")})},destroy:function(){this.exec("destroy");this.disconnectRuntime();this.off()}});J.installTo(G.prototype);return G});D("lib/image",["base","runtime/client","lib/blob"],function(F,J,G){var H=F.$;function I(K){this.options=H.extend({},I.options,K);J.call(this,"Image");this.on("load",function(){this._info=this.exec("info");this._meta=this.exec("meta")})}I.options={quality:90,crop:false,preserveHeaders:true,allowMagnify:true};F.inherits(J,{constructor:I,info:function(K){if(K){this._info=K;return this}return this._info},meta:function(K){if(K){this._meta=K;return this}return this._meta},loadFromBlob:function(L){var M=this,K=L.getRuid();this.connectRuntime(K,function(){M.exec("init",M.options);M.exec("loadFromBlob",L)})},resize:function(){var K=F.slice(arguments);return this.exec.apply(this,["resize"].concat(K))},getAsDataUrl:function(K){return this.exec("getAsDataUrl",K)},getAsBlob:function(K){var L=this.exec("getAsBlob",K);return new G(this.getRuid(),L)}});return I});D("lib/transport",["base","runtime/client","mediator"],function(G,J,I){var H=G.$;function F(K){var L=this;K=L.options=H.extend(true,{},F.options,K||{});J.call(this,"Transport");this._blob=null;this._formData=K.formData||{};this._headers=K.headers||{};this.on("progress",this._timeout);this.on("load error",function(){L.trigger("progress",1);clearTimeout(L._timer)})}F.options={server:"",method:"POST",withCredentials:false,fileVar:"file",timeout:2*60*1000,formData:{},headers:{},sendAsBinary:false};H.extend(F.prototype,{appendBlob:function(L,N,M){var O=this,K=O.options;if(O.getRuid()){O.disconnectRuntime()}O.connectRuntime(N.ruid,function(){O.exec("init")});O._blob=N;K.fileVar=L||K.fileVar;K.filename=M||K.filename},append:function(L,K){if(typeof L==="object"){H.extend(this._formData,L)}else{this._formData[L]=K}},setRequestHeader:function(L,K){if(typeof L==="object"){H.extend(this._headers,L)}else{this._headers[L]=K}},send:function(K){this.exec("send",K);this._timeout()},abort:function(){clearTimeout(this._timer);return this.exec("abort")},destroy:function(){this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()},getResponse:function(){return this.exec("getResponse")},getResponseAsJson:function(){return this.exec("getResponseAsJson")},getStatus:function(){return this.exec("getStatus")},_timeout:function(){var L=this,K=L.options.timeout;if(!K){return}clearTimeout(L._timer);L._timer=setTimeout(function(){L.abort();L.trigger("error","timeout")},K)}});I.installTo(F.prototype);return F});D("queue",["base","mediator","file"],function(G,K,J){var I=G.$,H=J.Status;function F(){this.stats={numOfQueue:0,numOfSuccess:0,numOfCancel:0,numOfProgress:0,numOfUploadFailed:0,numOfInvalid:0};this._queue=[];this._map={}}I.extend(F.prototype,{append:function(L){this._queue.push(L);this._fileAdded(L);return this},prepend:function(L){this._queue.unshift(L);this._fileAdded(L);return this},getFile:function(L){if(typeof L!=="string"){return L}return this._map[L]},fetch:function(M){var L=this._queue.length,N,O;M=M||H.QUEUED;for(N=0;N<L;N++){O=this._queue[N];if(M===O.getStatus()){return O}}return null},getFiles:function(){var O=[].slice.call(arguments,0),P=[],N=0,L=this._queue.length,M;for(;N<L;N++){M=this._queue[N];if(O.length&&!~I.inArray(M.getStatus(),O)){continue}P.push(M)}return P},_fileAdded:function(N){var L=this,M=this._map[N.id];if(!M){this._map[N.id]=N;N.on("statuschange",function(P,O){L._onFileStatusChange(P,O)})}N.setStatus(H.QUEUED)},_onFileStatusChange:function(N,M){var L=this.stats;switch(M){case H.PROGRESS:L.numOfProgress--;break;case H.QUEUED:L.numOfQueue--;break;case H.ERROR:L.numOfUploadFailed--;break;case H.INVALID:L.numOfInvalid--;break}switch(N){case H.QUEUED:L.numOfQueue++;break;case H.PROGRESS:L.numOfProgress++;break;case H.ERROR:L.numOfUploadFailed++;break;case H.COMPLETE:L.numOfSuccess++;break;case H.CANCELLED:L.numOfCancel++;break;case H.INVALID:L.numOfInvalid++;break}}});K.installTo(F.prototype);return F});D("runtime/compbase",function(){function F(G,H){this.owner=G;this.options=G.options;this.getRuntime=function(){return H};this.getRuid=function(){return H.uid};this.trigger=function(){return G.trigger.apply(G,arguments)}}return F});D("runtime/flash/runtime",["base","runtime/runtime","runtime/compbase"],function(L,J,F){var G=L.$,H="flash",K={};function I(){var O;try{O=navigator.plugins["Shockwave Flash"];O=O.description}catch(P){try{O=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(N){O="0.0"}}O=O.match(/\d+/g);return parseFloat(O[0]+"."+O[1],10)}function M(){var N={},P={},R=this.destory,S=this,Q=L.guid("webuploader_");J.apply(S,arguments);S.type=H;S.exec=function(Y,T){var X=this,V=X.uid,U=L.slice(arguments,2),W;P[V]=X;if(K[Y]){if(!N[V]){N[V]=new K[Y](X,S)}W=N[V];if(W[T]){return W[T].apply(W,U)}}return S.flashExec.apply(X,arguments)};function O(U,X){var V=U.type||U,W,T;W=V.split("::");T=W[0];V=W[1];if(V==="Ready"&&T===S.uid){S.trigger("ready")}else{if(P[T]){P[T].trigger(V.toLowerCase(),U,X)}}}C[Q]=function(){var T=arguments;setTimeout(function(){O.apply(null,T)},1)};this.jsreciver=Q;this.destory=function(){return R&&R.apply(this,arguments)};this.flashExec=function(W,T){var U=S.getFlash(),V=L.slice(arguments,2);return U.exec(this.uid,W,T,V)}}L.inherits(J,{constructor:M,init:function(){var O=this.getContainer(),N=this.options,P;O.css({position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"});P='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+N.swf+'" ';if(L.isIE){P+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '}P+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+N.swf+'" /><param name="flashvars" value="uid='+this.uid+"&jsreciver="+this.jsreciver+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>';O.html(P)},getFlash:function(){if(this._flash){return this._flash}this._flash=G("#"+this.uid).get(0);return this._flash}});M.register=function(N,O){O=K[N]=L.inherits(F,G.extend({flashExec:function(){var P=this.owner,Q=this.getRuntime();return Q.flashExec.apply(P,arguments)}},O));return O};if(I()>=11.3){J.addRuntime(H,M)}return M});D("runtime/flash/filepicker",["base","runtime/flash/runtime"],function(G,F){var H=G.$;return F.register("FilePicker",{init:function(I){var J=H.extend({},I);delete J.button;delete J.container;this.flashExec("FilePicker","init",J)},destroy:function(){}})});D("runtime/flash/image",["runtime/flash/runtime"],function(F){return F.register("Image",{loadFromBlob:function(H){var G=this.owner;G.info()&&this.flashExec("Image","info",G.info());G.meta()&&this.flashExec("Image","meta",G.meta());this.flashExec("Image","loadFromBlob",H.uid)}})});D("runtime/flash/transport",["base","runtime/flash/runtime","runtime/client"],function(G,F,H){return F.register("Transport",{init:function(){this._status=0;this._response=null;this._responseJson=null},send:function(){var I=this.owner,L=this.options,N=this._initAjax(),K=I._blob,M=L.server,J;N.connectRuntime(K.ruid);if(L.sendAsBinary){M+=(/\?/.test(M)?"&":"?")+$.param(I._formData);J=K.uid}else{$.each(I._formData,function(P,O){N.exec("append",P,O)});N.exec("appendBlob",L.fileVar,K.uid,L.filename||I._formData.name||"")}this._setRequestHeader(N,L.headers);N.exec("send",{method:L.method,url:M},J)},getStatus:function(){return this._status},getResponse:function(){return this._response},getResponseAsJson:function(){return this._responseJson},abort:function(){var I=this._xhr;if(I){I.exec("abort");I.destroy();this._xhr=I=null}},destroy:function(){this.abort()},_initAjax:function(){var J=this,I=new H("XMLHttpRequest");I.on("uploadprogress progress",function(K){return J.trigger("progress",K.loaded/K.total)});I.on("load",function(){var K=I.exec("getStatus");I.off();J._xhr=null;if(K===200){J._response=I.exec("getResponse");J._responseJson=I.exec("getResponseAsJson");return J.trigger("load")}J._status=K;I.destroy();I=null;return J.trigger("error","http")});I.on("error",function(){I.off();J._xhr=null;J.trigger("error","http")});J._xhr=I;return I},_setRequestHeader:function(J,I){$.each(I,function(K,L){J.exec("setRequestHeader",K,L)})}})});D("runtime/html5/runtime",["base","runtime/runtime","runtime/compbase"],function(G,I,J){var K="html5",H={};function F(){var L={},N=this,M=this.destory;I.apply(N,arguments);N.type=K;N.exec=function(T,O){var S=this,Q=S.uid,P=G.slice(arguments,2),R;if(H[T]){R=L[Q]=L[Q]||new H[T](S,N);if(R[O]){return R[O].apply(R,P)}}};N.destory=function(){return M&&M.apply(this,arguments)}}G.inherits(I,{constructor:F,init:function(){var L=this;setTimeout(function(){L.trigger("ready")},1)}});F.register=function(L,N){var M=H[L]=G.inherits(J,N);return M};if(C.Blob&&C.FileReader&&C.DataView){I.addRuntime(K,F)}return F});D("runtime/html5/blob",["runtime/html5/runtime","lib/blob"],function(F,G){return F.register("Blob",{slice:function(H,I){var K=this.owner.source,J=K.slice||K.webkitSlice||K.mozSlice;K=J.call(K,H,I);return new G(this.getRuid(),K)}})});D("runtime/html5/dnd",["base","runtime/html5/runtime","lib/file"],function(H,G,F){var I=H.$;return G.register("DragAndDrop",{init:function(){var J=this.elem=this.options.container;this.dragEnterHandler=H.bindFn(this._dragEnterHandler,this);this.dragOverHandler=H.bindFn(this._dragOverHandler,this);this.dragLeaveHandler=H.bindFn(this._dragLeaveHandler,this);this.dropHandler=H.bindFn(this._dropHandler,this);J.on("dragenter",this.dragEnterHandler);J.on("dragover",this.dragOverHandler);J.on("dragleave",this.dragLeaveHandler);J.on("drop",this.dropHandler);if(this.options.disableGlobalDnd){I(document).on("dragover",this.dragOverHandler);I(document).on("drop",this.dropHandler)}},_dragEnterHandler:function(J){dragEnter(J);this.elem.addClass("webuploader-dnd-over");J=J.originalEvent||J;J.dataTransfer.dropEffect="copy";return false},_dragOverHandler:function(J){dragOver(J);if(!I.contains(this.elem.parent().get(0),J.target)){return false}this._dragEnterHandler.call(this,J);return false},_dragLeaveHandler:function(){dragLeave();this.elem.removeClass("webuploader-dnd-over");return false},_dropHandler:function(Q){dragDrop(Q);var N=[],M=[],S=this,K=S.getRuid(),L,P,O,R,J,T,U;if(!I.contains(S.elem.parent().get(0),Q.target)){return false}Q=Q.originalEvent||Q;O=Q.dataTransfer;L=O.items;P=O.files;U=!!(L&&L[0].webkitGetAsEntry);for(J=0,T=P.length;J<T;J++){R=P[J];if(L!=E&&L[J].webkitGetAsEntry()!=null&&L[J].webkitGetAsEntry().isDirectory){if(U){M.push(this._traverseDirectoryTree(L[J].webkitGetAsEntry(),N))}}else{N.push(R)}}H.when.apply(H,M).done(function(){S.trigger("drop",I.map(N,function(V){return new F(K,V)}))});this.elem.removeClass("webuploader-dnd-over");return false},_traverseDirectoryTree:function(J,L){var K=H.Deferred(),M=this;if(J.isFile){J.file(function(N){L.push(N);K.resolve(true)})}else{if(J.isDirectory){J.createReader().readEntries(function(O){var N=O.length,Q=[],P=[],R;for(R=0;R<N;R++){Q.push(M._traverseDirectoryTree(O[R],P))}H.when.apply(H,Q).then(function(){L.push.apply(L,P);K.resolve(true)},K.reject)})}}return K.promise()},destroy:function(){var J=this.elem;J.off("dragenter",this.dragEnterHandler);J.off("dragover",this.dragEnterHandler);J.off("dragleave",this.dragLeaveHandler);J.off("drop",this.dropHandler);if(this.options.disableGlobalDnd){I(document).off("dragover",this.dragOverHandler);I(document).off("drop",this.dropHandler)}}})});D("runtime/html5/filepaste",["base","runtime/html5/runtime","lib/file"],function(H,G,F){return G.register("FilePaste",{init:function(){var I=this.options,M=this.elem=I.container,O=".*",K,N,L,J;if(I.accept){K=[];for(N=0,L=I.accept.length;N<L;N++){J=I.accept[N].mimeTypes;J&&K.push(J)}if(K.length){O=K.join(",");O=O.replace(/,/g,"|").replace(/\*/g,".*")}}this.accept=O=new RegExp(O,"i");this.hander=H.bindFn(this._pasteHander,this);M.on("paste",this.hander)},_pasteHander:function(M){var P=[],J=this.getRuid(),L,N,K,I,O;M=M.originalEvent||M;M.preventDefault();M.stopPropagation();L=M.clipboardData.items;for(I=0,O=L.length;I<O;I++){N=L[I];if(!N.type||!(K=N.getAsFile())||K.size<6){continue}P.push(new F(J,K))}P.length&&this.trigger("paste",P)},destroy:function(){this.elem.off("paste",this.hander)}})});D("runtime/html5/filepicker",["base","runtime/html5/runtime"],function(G,F){var H=G.$;return F.register("FilePicker",{init:function(){var J=this.getRuntime().getContainer(),P=this,L=P.owner,R=P.options,N=H(document.createElement("label")),O=H(document.createElement("input")),M,I,Q,K;O.attr("type","file");O.css({position:"absolute",clip:"rect(1px,1px,1px,1px)"});N.on("click",function(){O.trigger("click")});N.css({opacity:0,width:"100%",height:"100%",display:"block",cursor:"pointer",background:"#ffffff"});if(R.multiple){O.attr("multiple","multiple")}if(R.accept&&R.accept.length>0){M=[];for(I=0,Q=R.accept.length;I<Q;I++){M.push(R.accept[I].mimeTypes)}O.attr("accept",M.join(","))}J.append(O);J.append(N);K=function(S){L.trigger(S.type)};O.on("change",function(T){var S=arguments.callee,U;P.files=T.target.files;U=this.cloneNode(true);this.parentNode.replaceChild(U,this);O.off();O=H(U).on("change",S).on("mouseenter mouseleave",K);L.trigger("change")});N.on("mouseenter mouseleave",K)},getFiles:function(){return this.files},destroy:function(){}})});D("runtime/html5/util",function(){var F=C.createObjectURL&&C||C.URL&&URL.revokeObjectURL&&URL||C.webkitURL;return{createObjectURL:F&&F.createObjectURL,revokeObjectURL:F&&F.revokeObjectURL,dataURL2Blob:function(J){var L,G,M,K,I,H;H=J.split(",");if(~H[0].indexOf("base64")){L=atob(H[1])}else{L=decodeURIComponent(H[1])}M=new ArrayBuffer(L.length);G=new Uint8Array(M);for(K=0;K<L.length;K++){G[K]=L.charCodeAt(K)}I=H[0].split(":")[1].split(";")[0];return new Blob([M],{type:I})},dataURL2ArrayBuffer:function(H){var J,G,I,K;K=H.split(",");if(~K[0].indexOf("base64")){J=atob(K[1])}else{J=decodeURIComponent(K[1])}G=new Uint8Array(J.length);for(I=0;I<J.length;I++){G[I]=J.charCodeAt(I)}return G.buffer},arrayBufferToBlob:function(H,G){return new Blob([H],G?{type:G}:{})}}});D("runtime/html5/imagemeta",function(){var F;F={parsers:{65505:[]},maxMetaDataSize:262144,parse:function(I,G){var J=this,H=new FileReader();H.onload=function(){G(false,J._parse(this.result));H=H.onload=H.onerror=null};H.onerror=function(K){G(K.message);H=H.onload=H.onerror=null};I=I.slice(0,J.maxMetaDataSize);H.readAsArrayBuffer(I.getSource())},_parse:function(I,K){if(I.byteLength<6){return}var O=new DataView(I),Q=2,N=O.byteLength-4,M=Q,H={},L,P,G,J;if(O.getUint16(0)===65496){while(Q<N){L=O.getUint16(Q);if(L>=65504&&L<=65519||L===65534){P=O.getUint16(Q+2)+2;if(Q+P>O.byteLength){break}G=F.parsers[L];if(!K&&G){for(J=0;J<G.length;J+=1){G[J].call(F,O,Q,P,H)}}Q+=P;M=Q}else{break}}if(M>6){if(I.slice){H.imageHead=I.slice(2,M)}else{H.imageHead=new Uint8Array(I).subarray(2,M)}}}return H},updateImageHead:function(H,G){var L=this._parse(H,true),J,I,K;K=2;if(L.imageHead){K=2+L.imageHead.byteLength}if(H.slice){I=H.slice(K)}else{I=new Uint8Array(H).subarray(K)}J=new Uint8Array(G.byteLength+2+I.byteLength);J[0]=255;J[1]=216;J.set(new Uint8Array(G),2);J.set(new Uint8Array(I),G.byteLength+2);return J.buffer}};return F});D("runtime/html5/image",["runtime/html5/runtime","runtime/html5/util","runtime/html5/imagemeta"],function(G,I,F){var H="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D";return G.register("Image",{modified:false,init:function(){var K=this,J=new Image();J.onload=function(){K._info={type:K.type,width:this.width,height:this.height};if(!K._metas&&~"image/jpegimage/jpg".indexOf(K.type)){F.parse(K._blob,function(M,L){K._metas=L;K.owner.trigger("load")})}else{K.owner.trigger("load")}};J.onerror=function(){K.owner.trigger("error")};K._img=J},loadFromBlob:function(K){var L=this,J=L._img;L._blob=K;L.type=K.type;J.src=I.createObjectURL(K.getSource());L.owner.once("load",function(){I.revokeObjectURL(J.src)})},resize:function(K,J){var L=this._canvas||(this._canvas=document.createElement("canvas"));this._resize(this._img,L,K,J);this._blob=null;this.modified=true;this.owner.trigger("complete")},getAsBlob:function(K){var M=this._blob,J=this.options,L;K=K||this.type;if(this.modified||this.type!==K){L=this._canvas;if(K==="image/jpeg"){M=L.toDataURL("image/jpeg",J.quality/100);if(J.preserveHeaders&&this._metas&&this._metas.imageHead){M=I.dataURL2ArrayBuffer(M);M=F.updateImageHead(M,this._metas.imageHead);M=I.arrayBufferToBlob(M,K);return M}}else{M=L.toDataURL(K)}M=I.dataURL2Blob(M)}return M},getAsDataUrl:function(K){var J=this.options;K=K||this.type;if(K==="image/jpeg"){return this._canvas.toDataURL(K,J.quality/100)}else{return this._canvas.toDataURL(K)}},getOrientation:function(){return this._metas&&this._metas.exif&&this._metas.exif.get("Orientation")||1},info:function(J){if(J){this._info=J;return this}return this._info},meta:function(J){if(J){this._meta=J;return this}return this._meta},destroy:function(){var J=this._canvas;this._img.onload=null;if(J){J.getContext("2d").clearRect(0,0,J.width,J.height);J.width=J.height=0;this._canvas=null}this._img.src=H;this._img=this._blob=null},_resize:function(K,T,J,O){var P=this.options,S=K.width,V=K.height,Q=this.getOrientation(),L,U,R,M,N;if(~[5,6,7,8].indexOf(Q)){J^=O;O^=J;J^=O}L=Math[P.crop?"max":"min"](J/S,O/V);P.allowMagnify||(L=Math.min(1,L));U=S*L;R=V*L;if(P.crop){T.width=J;T.height=O}else{T.width=U;T.height=R}M=(T.width-U)/2;N=(T.height-R)/2;P.preserveHeaders||this._rotate2Orientaion(T,Q);this._renderImageToCanvas(T,K,M,N,U,R)},_rotate2Orientaion:function(N,M){var L=N.width,J=N.height,K=N.getContext("2d");switch(M){case 5:case 6:case 7:case 8:N.width=J;N.height=L;break}switch(M){case 2:K.translate(L,0);K.scale(-1,1);break;case 3:K.translate(L,J);K.rotate(Math.PI);break;case 4:K.translate(0,J);K.scale(1,-1);break;case 5:K.rotate(0.5*Math.PI);K.scale(1,-1);break;case 6:K.rotate(0.5*Math.PI);K.translate(0,-J);break;case 7:K.rotate(0.5*Math.PI);K.translate(L,-J);K.scale(-1,1);break;case 8:K.rotate(-0.5*Math.PI);K.translate(-L,0);break}},_renderImageToCanvas:function(O,L,J,K,M,N){O.getContext("2d").drawImage(L,J,K,M,N)}})});D("runtime/html5/imagemeta/exif",["base","runtime/html5/imagemeta"],function(G,F){var H={};H.ExifMap=function(){return this};H.ExifMap.prototype.map={"Orientation":274};H.ExifMap.prototype.get=function(I){return this[I]||this[this.map[I]]};H.exifTagTypes={1:{getValue:function(J,I){return J.getUint8(I)},size:1},2:{getValue:function(J,I){return String.fromCharCode(J.getUint8(I))},size:1,ascii:true},3:{getValue:function(K,I,J){return K.getUint16(I,J)},size:2},4:{getValue:function(K,I,J){return K.getUint32(I,J)},size:4},5:{getValue:function(K,I,J){return K.getUint32(I,J)/K.getUint32(I+4,J)},size:8},9:{getValue:function(K,I,J){return K.getInt32(I,J)},size:4},10:{getValue:function(K,I,J){return K.getInt32(I,J)/K.getInt32(I+4,J)},size:8}};H.exifTagTypes[7]=H.exifTagTypes[1];H.getExifValue=function(J,U,I,K,S,L){var M=H.exifTagTypes[K],T,R,Q,O,P,N;if(!M){G.log("Invalid Exif data: Invalid tag type.");return}T=M.size*S;R=T>4?U+J.getUint32(I+8,L):(I+8);if(R+T>J.byteLength){G.log("Invalid Exif data: Invalid data offset.");return}if(S===1){return M.getValue(J,R,L)}Q=[];for(O=0;O<S;O+=1){Q[O]=M.getValue(J,R+O*M.size,L)}if(M.ascii){P="";for(O=0;O<Q.length;O+=1){N=Q[O];if(N==="\u0000"){break}P+=N}return P}return Q};H.parseExifTag=function(M,L,K,J,N){var I=M.getUint16(K,J);N.exif[I]=H.getExifValue(M,L,K,M.getUint16(K+2,J),M.getUint32(K+4,J),J)};H.parseExifTags=function(K,P,N,L,M){var O,J,I;if(N+6>K.byteLength){G.log("Invalid Exif data: Invalid directory offset.");return}O=K.getUint16(N,L);J=N+2+12*O;if(J+4>K.byteLength){G.log("Invalid Exif data: Invalid directory size.");return}for(I=0;I<O;I+=1){this.parseExifTag(K,P,N+2+12*I,L,M)}return K.getUint32(J,L)};H.parseExifData=function(N,M,J,O){var I=M+10,K,L;if(N.getUint32(M+4)!==1165519206){return}if(I+8>N.byteLength){G.log("Invalid Exif data: Invalid segment size.");return}if(N.getUint16(M+8)!==0){G.log("Invalid Exif data: Missing byte alignment offset.");return}switch(N.getUint16(I)){case 18761:K=true;break;case 19789:K=false;break;default:G.log("Invalid Exif data: Invalid byte alignment marker.");return}if(N.getUint16(I+2,K)!==42){G.log("Invalid Exif data: Missing TIFF marker.");return}L=N.getUint32(I+4,K);O.exif=new H.ExifMap();L=H.parseExifTags(N,I,I+L,K,O)};F.parsers[65505].push(H.parseExifData);return H});D("runtime/html5/transport",["base","runtime/html5/runtime"],function(G,F){var I=G.noop,H=G.$;return F.register("Transport",{init:function(){this._status=0;this._response=null},send:function(){var J=this.owner,M=this.options,O=this._initAjax(),L=J._blob,N=M.server,K,P;if(M.sendAsBinary){N+=(/\?/.test(N)?"&":"?")+H.param(J._formData);P=L.getSource()}else{K=new FormData();H.each(J._formData,function(R,Q){K.append(R,Q)});K.append(M.fileVar,L.getSource(),M.filename||J._formData.name||"")}if(M.withCredentials&&"withCredentials" in O){O.open(M.method,N,true);O.withCredentials=true}else{O.open(M.method,N)}this._setRequestHeader(O,M.headers);P&&O.overrideMimeType("application/octet-stream");O.send(P||K)},getResponse:function(){return this._response},getResponseAsJson:function(){return this._parseJson(this._response)},getStatus:function(){return this._status},abort:function(){var J=this._xhr;if(J){J.upload.onprogress=I;J.onreadystatechange=I;J.abort();this._xhr=J=null}},destroy:function(){this.abort()},_initAjax:function(){var L=this,K=new XMLHttpRequest(),J=this.options;if(J.withCredentials&&!("withCredentials" in K)&&typeof XDomainRequest!=="undefined"){K=new XDomainRequest()}K.upload.onprogress=function(M){var N=0;if(M.lengthComputable){N=M.loaded/M.total}return L.trigger("progress",N)};K.onreadystatechange=function(){if(K.readyState!==4){return}K.upload.onprogress=I;K.onreadystatechange=I;L._xhr=null;if(K.status===200){L._response=K.responseText;return L.trigger("load")}L._status=K.status;K=null;return L.trigger("error",L._status?"http":"abort")};L._xhr=K;return K},_setRequestHeader:function(K,J){H.each(J,function(L,M){K.setRequestHeader(L,M)})},_parseJson:function(K){var J;try{J=JSON.parse(K)}catch(L){J={}}return J}})});D("widgets/filednd",["base","uploader","lib/dnd","widgets/widget"],function(F,G,H){G.options.dnd="";return G.register({init:function(I){if(!I.dnd||this.request("predict-runtime-type")!=="html5"){return}var M=this,L=F.Deferred(),K=$.extend({},{container:I.dnd,accept:I.accept}),J;J=new H(K);J.once("ready",L.resolve);J.on("drop",function(N){M.request("add-file",[N])});J.init();return L.promise()}})});D("widgets/filepaste",["base","uploader","lib/filepaste","widgets/widget"],function(F,H,G){return H.register({init:function(I){if(!I.paste||this.request("predict-runtime-type")!=="html5"){return}var M=this,K=F.Deferred(),J=$.extend({},{container:I.paste,accept:I.accept}),L;L=new G(J);L.once("ready",K.resolve);L.on("paste",function(N){M.owner.request("add-file",[N])});L.init();return K.promise()}})});D("widgets/image",["base","uploader","lib/image","widgets/widget"],function(F,H,I){var G=F.$,J;J=(function(N){var L=0,M=[],K=function(){var O;while(M.length&&L<N){O=M.shift();L+=O[0];O[1]()}};return function(Q,O,P){M.push([O,P]);Q.once("destroy",function(){L-=O;setTimeout(K,1)});setTimeout(K,1)}})(5*1024*1024);G.extend(H.options,{thumb:{width:110,height:110,quality:70,allowMagnify:true,crop:true,preserveHeaders:false,type:"image/jpeg"},compress:{width:1600,height:1600,quality:90,allowMagnify:false,crop:false,preserveHeaders:true}});return H.register({"make-thumb":"makeThumb","before-send-file":"compressImage"},{makeThumb:function(P,K,M,L){var N,O;P=this.request("get-file",P);if(!P.type.match(/^image/)){K(true);return}N=G.extend({},this.options.thumb);if(G.isPlainObject(M)){N=G.extend(N,M);M=null}M=M||N.width;L=L||N.height;O=new I(N);O.once("load",function(){P._info=P._info||O.info();P._meta=P._meta||O.meta();O.resize(M,L)});O.once("complete",function(){K(false,O.getAsDataUrl(N.type));O.destroy()});O.once("error",function(){K(true);O.destroy()});J(O,P.source.size,function(){P._info&&O.info(P._info);P._meta&&O.meta(P._meta);O.loadFromBlob(P.source)})},compressImage:function(O){var K=this.options.compress||this.options.resize,L=K&&K.compressSize||300*1024,N,M;O=this.request("get-file",O);if(!K||!~"image/jpeg,image/jpg".indexOf(O.type)||O.size<L||O._compressed){return}K=G.extend({},K);M=F.Deferred();N=new I(K);M.always(function(){N.destroy();N=null});N.once("error",M.reject);N.once("load",function(){O._info=O._info||N.info();O._meta=O._meta||N.meta();N.resize(K.width,K.height)});N.once("complete",function(){var Q,P;Q=N.getAsBlob(K.type);P=O.size;if(Q.size<P){O.source=Q;O.size=Q.size;O.trigger("resize",Q.size,P)}O._compressed=true;M.resolve(true)});O._info&&N.info(O._info);O._meta&&N.meta(O._meta);N.loadFromBlob(O.source);return M.promise()}})});D("widgets/queue",["base","uploader","queue","file","widgets/widget"],function(F,I,K,J){var H=F.$,L=/\.\w+$/,G=J.Status;return I.register({"add-file":"addFiles","get-file":"getFile","fetch-file":"fetchFile","get-stats":"getStats","get-files":"getFiles","remove-file":"removeFile","retry":"retry"},{init:function(M){var Q,P,R,O,N;if(H.isPlainObject(M.accept)){M.accept=[M.accept]}if(M.accept){O=[];for(P=0,Q=M.accept.length;P<Q;P++){R=M.accept[P].extensions;R&&O.push(R)}if(O.length){N="\\."+O.join(",").replace(/,/g,"$|\\.").replace(/\*/g,".*")+"$"}this.accept=new RegExp(N,"i")}this.queue=new K();this.stats=this.queue.stats},_addFile:function(N){var M=this;if(!N||N.size<6||M.accept&&L.exec(N.name)&&!M.accept.test(N.name)){return}if(!(N instanceof J)){N=new J(N)}if(!M.owner.trigger("beforeFileQueued",N)){return}M.queue.append(N);M.owner.trigger("fileQueued",N);return N},getFile:function(M){return this.queue.getFile(M)},addFiles:function(M){var N=this;if(!M.length){M=[M]}M=H.map(M,function(O){return N._addFile(O)});N.owner.trigger("filesQueued",M);if(N.options.auto){N.request("start-upload")}},getStats:function(){return this.stats},removeFile:function(N){var M=this;N=N.id?N:M.queue.getFile(N);N.setStatus(G.CANCELLED);M.owner.trigger("fileDequeued",N)},getFiles:function(){return this.queue.getFiles.apply(this.queue,arguments)},fetchFile:function(){return this.queue.fetch.apply(this.queue,arguments)},retry:function(R,M){var N=this,P,Q,O;if(R){R=R.id?R:N.queue.getFile(R);R.setStatus(G.QUEUED);M||N.request("start-upload");return}P=N.queue.getFiles(G.ERROR);Q=0;O=P.length;for(;Q<O;Q++){R=P[Q];R.setStatus(G.QUEUED)}N.request("start-upload")}})});D("widgets/runtime",["uploader","runtime/runtime","widgets/widget"],function(F,G){F.support=function(){return G.hasRuntime.apply(G,arguments)};return F.register({"predict-runtime-type":"predictRuntmeType"},{init:function(){if(!this.predictRuntmeType()){throw Error("Runtime Error")}},predictRuntmeType:function(){var I=this.options.runtimeOrder||G.orders,J=this.type,K,H;if(!J){I=I.split(/\s*,\s*/g);for(K=0,H=I.length;K<H;K++){if(G.hasRuntime(I[K])){this.type=J=I[K];break}}}return J}})});D("widgets/upload",["base","uploader","file","lib/transport","widgets/widget"],function(L,F,K,M){var H=L.$,I=L.isPromise,G=K.Status;H.extend(F.options,{prepareNextFile:false,chunked:false,chunkSize:5*1024*1024,chunkRetry:2,threads:3,formdata:null});function J(T,V){var S=[],P=T.source,R=P.size,N=V?Math.ceil(R/V):1,U=0,Q=0,O;while(Q<N){O=Math.min(V,R-U);S.push({file:T,start:U,end:U+O,total:R,chunks:N,chunk:Q++});U+=O}T.blocks=S.concat();T.remaning=S.length;return{file:T,has:function(){return !!S.length},fetch:function(){return S.shift()}}}F.register({"start-upload":"start","stop-upload":"stop","skip-file":"skipFile","is-in-progress":"isInProgress"},{init:function(){var N=this.owner;this.runing=false;this.pool=[];this.pending=[];this.remaning=0;this.__tick=L.bindFn(this._tick,this);N.on("uploadComplete",function(O){O.blocks&&H.each(O.blocks,function(Q,P){P.transport&&(P.transport.abort(),P.transport.destroy());delete P.transport});delete O.blocks;delete O.remaning})},start:function(){var N=this;H.each(N.request("get-files",G.INVALID),function(){N.request("remove-file",this)});if(N.runing){return}N.runing=true;H.each(N.pool,function(P,O){var Q=O.file;if(Q.getStatus()===G.INTERRUPT){Q.setStatus(G.PROGRESS);N._trigged=false;O.transport&&O.transport.send()}});N._trigged=false;N.owner.trigger("startUpload");L.nextTick(N.__tick)},stop:function(O){var N=this;if(N.runing===false){return}N.runing=false;O&&H.each(N.pool,function(Q,P){P.transport&&P.transport.abort();P.file.setStatus(G.INTERRUPT)});N.owner.trigger("stopUpload")},isInProgress:function(){return !!this.runing},getStats:function(){return this.request("get-stats")},skipFile:function(O,N){O=this.request("get-file",O);O.setStatus(N||G.COMPLETE);O.skipped=true;O.blocks&&H.each(O.blocks,function(R,Q){var P=Q.transport;if(P){P.abort();P.destroy();delete Q.transport}});this.owner.trigger("uploadSkip",O)},_tick:function(){var Q=this,N=Q.options,O,P;if(Q._promise){return Q._promise.always(Q.__tick)}if(Q.pool.length<N.threads&&(P=Q._nextBlock())){Q._trigged=false;O=function(R){Q._promise=null;R&&R.file&&Q._startSend(R);L.nextTick(Q.__tick)};Q._promise=I(P)?P.always(O):O(P)}else{if(!Q.remaning&&!Q.getStats().numOfQueue){Q.runing=false;Q._trigged||L.nextTick(function(){Q.owner.trigger("uploadFinished")});Q._trigged=true}}},_nextBlock:function(){var R=this,P=R._act,N=R.options,Q,O;if(P&&P.has()&&P.file.getStatus()===G.PROGRESS){if(N.prepareNextFile&&!R.pending.length){R._prepareNextFile()}return P.fetch()}else{if(R.runing){if(!R.pending.length&&R.getStats().numOfQueue){R._prepareNextFile()}Q=R.pending.shift();O=function(S){if(!S){return null}P=J(S,N.chunked?N.chunkSize:0);R._act=P;return P.fetch()};return I(Q)?Q.then(O):O(Q)}}},_prepareNextFile:function(){var Q=this,P=Q.request("fetch-file"),O=Q.pending,N;if(P){N=Q.request("before-send-file",P,function(){if(P.getStatus()===G.QUEUED){Q.owner.trigger("uploadStart",P);P.setStatus(G.PROGRESS);return P}return Q._finishFile(P)});N.done(function(){var R=H.inArray(N,O);~R&&O.splice(R,1,P)});N.fail(function(R){P.setStatus(G.ERROR,R);Q.owner.trigger("uploadError",P,R);Q.owner.trigger("uploadComplete",P)});O.push(N)}},_popBlock:function(N){var O=H.inArray(N,this.pool);this.pool.splice(O,1);N.file.remaning--;this.remaning--},_startSend:function(O){var Q=this,P=O.file,N;Q.pool.push(O);Q.remaning++;O.blob=O.chunks===1?P.source:P.source.slice(O.start,O.end);N=Q.request("before-send",O,function(){if(P.getStatus()===G.PROGRESS){Q._doSend(O)}else{Q._popBlock(O);L.nextTick(Q.__tick)}});N.fail(function(){if(P.remaning===1){Q._finishFile(P).always(function(){O.percentage=1;Q._popBlock(O);Q.owner.trigger("uploadComplete",P);L.nextTick(Q.__tick)})}else{O.percentage=1;Q._popBlock(O);L.nextTick(Q.__tick)}})},_doSend:function(N){var R=this,P=R.owner,U=R.options,Q=N.file,S=new M(U),O=H.extend({},U.formData),T=H.extend({},U.headers);N.transport=S;S.on("destroy",function(){delete N.transport;R._popBlock(N);L.nextTick(R.__tick)});S.on("progress",function(X){var V=0,W=0;V=N.percentage=X;if(N.chunks>1){H.each(Q.blocks,function(Z,Y){W+=(Y.percentage||0)*(Y.end-Y.start)});V=W/Q.size}P.trigger("uploadProgress",Q,V||0)});S.on("error",function(V){N.retried=N.retried||0;if(N.chunks>1&&~"http,abort".indexOf(V)&&N.retried<U.chunkRetry){N.retried++;S.send()}else{Q.setStatus(G.ERROR,V);P.trigger("uploadError",Q,V);P.trigger("uploadComplete",Q)}});S.on("load",function(){var X=S.getResponseAsJson()||{},W,V;X._raw=S.getResponse();V=function(Y){W=Y};if(!P.trigger("uploadAccept",N,X,V)){W=W||"server"}if(W){S.trigger("error",W);return}if(Q.remaning===1){R._finishFile(Q,X)}else{S.destroy()}});O=H.extend(O,{id:Q.id,name:Q.name,type:Q.type,lastModifiedDate:Q.lastModifiedDate,size:Q.size});N.chunks>1&&H.extend(O,{chunks:N.chunks,chunk:N.chunk});P.trigger("uploadBeforeSend",N,O,T);S.appendBlob(U.fileVal,N.blob,Q.name);S.append(O);S.setRequestHeader(T);S.send()},_finishFile:function(Q,P,O){var N=this.owner;return N.request("after-send-file",arguments,function(){Q.setStatus(G.COMPLETE);N.trigger("uploadSuccess",Q,P,O)}).fail(function(R){if(Q.getStatus()===G.PROGRESS){Q.setStatus(G.ERROR,R)}N.trigger("uploadError",Q,R)}).always(function(){N.trigger("uploadComplete",Q)})}})});D("widgets/validator",["base","uploader","file","widgets/widget"],function(G,I,J){var H=G.$,K={},F;F={addValidator:function(M,L){K[M]=L},removeValidator:function(L){delete K[L]}};I.register({init:function(){var L=this;H.each(K,function(){this.call(L.owner)})}});F.addValidator("fileNumLimit",function(){var N=this,L=N.options,P=0,O=L.fileNumLimit>>0,M=true;if(!O){return}N.on("beforeFileQueued",function(){if(P>=O&&M){M=false;this.trigger("error","Q_EXCEED_NUM_LIMIT",O);setTimeout(function(){M=true},1)}return P>=O?false:true});N.on("fileQueued",function(){P++});N.on("fileDequeued",function(){P--})});F.addValidator("fileSizeLimit",function(){var N=this,L=N.options,P=0,O=L.fileSizeLimit>>0,M=true;if(!O){return}N.on("beforeFileQueued",function(R){var Q=P+R.size>O;if(Q&&M){M=false;this.trigger("error","Q_EXCEED_SIZE_LIMIT",O);setTimeout(function(){M=true},1)}return Q?false:true});N.on("fileQueued",function(Q){P+=Q.size});N.on("fileDequeued",function(Q){P-=Q.size})});F.addValidator("fileSingleSizeLimit",function(){var M=this,L=M.options,N=L.fileSingleSizeLimit;if(!N){return}M.on("fileQueued",function(O){if(O.size>N){O.setStatus(J.Status.INVALID,"exceed_size")}})});F.addValidator("duplicate",function(){var N=this,L=N.options,O={};if(L.duplicate){return}function M(R){var Q=0,S=0,P=R.length,T;for(;S<P;S++){T=R.charCodeAt(S);Q=T+(Q<<6)+(Q<<16)-Q}return Q}N.on("beforeFileQueued",function(Q){var P=M(Q.name+Q.size+Q.lastModifiedDate);if(O[P]){return false}});N.on("fileQueued",function(Q){var P=M(Q.name+Q.size+Q.lastModifiedDate);O[P]=true});N.on("fileDequeued",function(Q){var P=M(Q.name+Q.size+Q.lastModifiedDate);delete O[P]})});return F});(function(J){var H=function(P){return P&&(P.charAt(0).toUpperCase()+P.substr(1))},G="WebUploader",L=J.base,O,N,K,I,M,F;for(O in J){N=L;if(!J.hasOwnProperty(O)){continue}K=O.split("/");M=H(K.pop());while((I=H(K.shift()))){N[I]=N[I]||{};N=N[I]}N[M]=J[O]}if(typeof module==="object"&&typeof module.exports==="object"){module.exports=L}else{if(C.define&&C.define.amd){C.define(function(){return L})}else{F=C[G];C[G]=L;C[G].noConflict=function(){C[G]=F}}}})(A.modules)})(this);